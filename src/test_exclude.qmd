---
title: "Test excluder"
format: html
editor: source
---

## Excluder

```{r}
library(tidyverse)
library(DiagrammeR)

source("exclude.R")
```

```{r}
load("~/data/private/new_donation_data/donationdata.20230606151703.rdata", verbose=TRUE)
donation <- donationdata$donation %>% head(n=2000)
statistics2 <- function(df) { list(count = nrow(df), donor_count=n_distinct(df$releaseID)) }

donation %>% 
  init_exclude("test2", statistics2) %>%
  filter(!is.na(DonationVolume)) %>%
  exclude("Excluded NA values in DonationVolume") %>%
  filter(!biobank) %>%
  exclude("Excluded biobank members")
  #excluder("Filtered NA values in DonationVolume ({old$count-new$count} donations, {old$donor_count-new$donor_count} donors)")
  
```

```{r}
get_tibble("test2") %>% plot_flow() %>% grViz()
```

```{r}
mpg %>% init_exclude("testi") %>%
  filter(manufacturer == "audi") %>%
  exclude()
```

```{r}
dump_exclude(filename = stdout())
#dump_excluder(filename = "/tmp/testi")
```


